<div id="togglePostFormLink" bis_skin_checked="1"><a href="#draggableForm">{% if post_mode == 'reply' %}[{{ lang['threadform-toggle-new-reply'] }}]{% else %}[{{ lang["thread-form-button"] }}]{% endif %}</a></div>

<div class="newboard-form" id="draggableForm">
    <form id="postform" action="/api/new_post" enctype="multipart/form-data" method="POST">
        <input type="hidden" name="board_id" value="{{ board_id }}">
        <input type="hidden" name="thread_id" value="{{ thread_id }}">
        <input type="hidden" name="post_mode" value="{{ post_mode }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="new-thread-container">
            <div class="new-thread-header">
                <h1>{% if post_mode == 'reply' %}{{ lang['threadform-title-new-reply'] }}{% else %}{{ lang["thread-form-button"] }}{% endif %}</h1>
            </div>
            <section class="row">
                {% set user_roles = (roles|default('')|string|lower) %}
                {% set is_global_admin = 'owner' in user_roles or 'mod' in user_roles %}
                {% set is_board_owner = 'username' in session and board_info and session["username"] == board_info.board_owner %}
                {% set is_board_staff = 'username' in session and board_info and session["username"] in board_info.board_staffs %}
                {% set is_privileged_for_name = is_global_admin or is_board_owner or is_board_staff %}
                {% set board_allow_name = (board_info.get('allow_name') if board_info else 1)|int %}

                {% if board_allow_name == 0 and not is_privileged_for_name %}
                <input type="hidden" name="name" value="{{ form_data.name if form_data else '' }}">
                {% else %}
                <div class="label" bis_skin_checked="1">{{ lang['threadform-label-name'] }}</div><input class="mr-1" type="text" name="name"
                    placeholder="{{ lang['threadform-placeholder-name'] }}" maxlength="40" value="{{ form_data.name if form_data else '' }}"><a class="close postform-style" href="#!"
                    bis_skin_checked="1">×</a>
                {% endif %}
            </section>
            <section class="row">
                <div class="label" bis_skin_checked="1"><span>{{ lang['threadform-label-subject'] }}</span></div><input type="text" name="subject"
                    autocomplete="off" placeholder="{{ lang['threadform-placeholder-subject'] }}" maxlength="50" value="{{ form_data.subject if form_data else '' }}">{% if board_info and (board_info.allow_name|int == 0) %}<a class="close postform-style" href="#!"
                    bis_skin_checked="1">×</a>{% endif %}
            </section>
            <section class="row">
                <div class="label" bis_skin_checked="1"><span>{{ lang['threadform-label-message'] }}</span><small>(0/20000)</small></div><textarea
                    id="text" name="text" rows="5" minlength="0" maxlength="20000">{{ form_data.text if form_data else '' }}</textarea>
            </section>
            <section class="row">
                <div class="label" bis_skin_checked="1"><span>{{ lang['threadform-label-files'] }}<span class="required">*</span></span>
                    <small>{{ lang['threadform-files-max'] }}</small><small>{{ lang['threadform-total-max'] }}</small>
                </div><span class="col"><label class="jsonly postform-style filelabel" for="post-file-uploader">
                        {{ lang['threadform-files-select'] }}</label><input id="post-file-uploader" type="file" name="fileInput" multiple=""
                        style="position: absolute; border: none; height: 1px; width: 1px;">
                    <div class="upload-list" data-spoilers="true" data-strip-filenames="true" bis_skin_checked="1">
                    </div>
                </span>
            </section>
            <section class="row">
                <div class="label" bis_skin_checked="1"><span>{{ lang['threadform-label-embed'] }}</span></div><input type="text" name="embed"
                    autocomplete="off" maxlength="100" placeholder="{{ lang['threadform-placeholder-embed'] }}" value="{{ form_data.embed if form_data else '' }}">
            </section>
            {% if board_info.enable_captcha %}
            {% if board_info.enable_captcha == 1%}
            <div class="row" bis_skin_checked="1">
                <div class="label" bis_skin_checked="1">{{ lang['threadform-label-captcha'] }}</div>
                <div class="captcha-container">
                    <img style="width: 100%;" src="{{ captcha_image }}" alt="">
                    <button type="button" class="captcha-refresh-btn" onclick="refreshCaptcha(this)">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </button>
                </div>
            </div>
            <div class="row" bis_skin_checked="1">
                <div class="label" bis_skin_checked="1">{{ lang['threadform-label-captcha'] }}</div>
                <input type="text" name="captcha" maxlength="100">
            </div>
            {% endif %}
            {% endif %}
            <input id="submitpost" type="submit" value="{{ lang['thread-form-button'] }}">
        </div>
    </form>
</div>
